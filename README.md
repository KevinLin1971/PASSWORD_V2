# 文件加密程式需求說明書

## 1. 專案概述
本文件加密系統旨在提供一種簡單且高度安全的方式來對本地文件進行加密和解密，以確保文件內容的機密性，並防止未經授權的存取。該系統將採用高級加密標準 (AES) 進行加密，並支援 Windows、Linux 和 macOS 環境下的運行。

## 2. 功能需求

### 2.1 文件加密功能
- 使用 AES-128 加密算法對文件進行加密處理。
- 支援加密任意類型的文件，並將加密後的文件保存為 `.enc` 副檔名。
- 每次加密操作均隨機生成初始向量 (IV)，以增強加密的安全性。

### 2.2 文件解密功能
- 支援對 `.enc` 文件的解密，將其還原為原始文件內容。
- 解密過程中必須提供加密所用的金鑰，以確保文件不被未經授權者解密。
- 解密後生成的文件名稱應與加密前相同，以便於識別和使用。

## 3. 非功能需求

### 3.1 安全性
- 使用密碼分組連鎖 (CBC) 模式進行加密，並使用隨機生成的 16 位元組金鑰與初始向量，確保加密強度。
- 金鑰必須安全地存儲，並且不得嵌入於程式碼中，以防止因金鑰洩露而導致的文件未經授權存取。
- 金鑰將存儲於 USB 裝置中，解密時需要驗證 USB 裝置的廠商 ID 和序列號，以確保金鑰只能由特定的 USB 裝置讀取，防止因金鑰洩露而被其他 USB 使用。
- 系統應為金鑰提供助記詞生成功能，用於在金鑰遺失時讓用戶能夠透過助記詞恢復金鑰，確保加密文件仍可被正當使用者解密。

### 3.2 可移植性
- 該系統應在 Windows、Linux 和 macOS 環境中均可運行，確保平台獨立性。
- 不依賴大型外部框架或複雜的安裝過程，應優先考慮使用常見的 Python 標準庫或輕量級外部庫。

## 4. 系統需求
- Python 版本：3.6 或更高版本
- 所需外部庫：
  - `pycryptodome`：用於 AES 加密和解密操作
  - `pyusb`：用於 USB 裝置的識別和驗證

## 5. 操作流程

### 5.1 加密流程
1. 用戶提供要加密的文件路徑。
2. 系統生成隨機的 16 位元組金鑰，並生成助記詞供用戶備份。
3. 使用 AES-CBC 模式對文件進行加密，並產生初始向量 (IV)。
4. 將 IV 和加密後的數據寫入新生成的加密文件，副檔名為 `.enc`。

### 5.2 解密流程
1. 用戶提供加密文件的路徑以及相應的金鑰 USB 裝置。
2. 系統檢查 USB 裝置的廠商 ID 和序列號是否匹配已註冊的設備。
3. 若驗證成功，則讀取 USB 裝置中的金鑰。
4. 系統讀取文件中的 IV 和加密數據。
5. 使用提供的金鑰和 IV 對加密數據進行解密。
6. 將解密後的數據寫回原始文件。

## 6. 錯誤處理
- 若文件不存在，系統應顯示相應的錯誤訊息。
- 若解密過程中提供的金鑰不正確，應提示用戶解密失敗。
- 若解密文件的副檔名不正確或文件格式不符合要求，系統應顯示錯誤訊息。
- 若 USB 裝置驗證失敗（例如廠商 ID 或序列號不匹配），應顯示錯誤並阻止解密操作。
- 若用戶無法找到金鑰，可透過助記詞來恢復金鑰，以進行解密操作。

## 7. 未來擴充性
- 支援其他加密算法，如 RSA，用於文件的非對稱加密。
- 開發圖形化使用者界面 (GUI)，以使操作更為直觀和方便。
- 增加對多文件或整個資料夾的批量加密功能。

## 8. 安全建議
- 採用強金鑰管理策略，避免將金鑰硬編碼於程式碼中，以免遭受逆向工程攻擊。
- 提供金鑰備份和恢復機制，以確保用戶在金鑰遺失的情況下仍可恢復加密文件。
- 建議用戶定期更換加密金鑰，以降低金鑰洩露風險。
- 金鑰應安全地存儲於專用 USB 裝置上，並利用 USB 裝置的唯一識別符號（如廠商 ID 和序列號）進行驗證，以進一步提升安全性和防止未經授權的金鑰使用。
- 使用助記詞備份金鑰，以確保用戶在 USB 裝置遺失或損壞時仍能透過助記詞恢復金鑰。

